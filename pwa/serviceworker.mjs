const { APPLICATION_CACHE_FILES, APPLICATION_CACHE_VERSION } = {"APPLICATION_CACHE_VERSION":"b167a98a-b35a-4f20-8386-485ecaa2c18b","APPLICATION_CACHE_FILES":["","app.mjs","appmanifest.webmanifest","assets/illustration-04.svg","assets/pegasus.webp","contexts/flux-app/src/Adapters/Api/FluxAppApi.mjs","contexts/flux-app/src/Adapters/Definitions/Definitions.mjs","contexts/flux-app/src/Adapters/MessageStream/MessageStream.mjs","contexts/flux-app/src/Core/Actor.mjs","contexts/flux-app/src/Core/Behaviors.mjs","contexts/flux-layout/.gitignore","contexts/flux-layout/definitions/api/api.json","contexts/flux-layout/definitions/css/stylesheet.css","contexts/flux-layout/definitions/templates/content-container.mjs","contexts/flux-layout/definitions/templates/header.mjs","contexts/flux-layout/definitions/templates/map.mjs","contexts/flux-layout/definitions/templates/menu-item.mjs","contexts/flux-layout/definitions/templates/menu.mjs","contexts/flux-layout/definitions/templates/string.mjs","contexts/flux-layout/node_modules/.package-lock.json","contexts/flux-layout/node_modules/leaflet/CHANGELOG.md","contexts/flux-layout/node_modules/leaflet/LICENSE","contexts/flux-layout/node_modules/leaflet/README.md","contexts/flux-layout/node_modules/leaflet/dist/images/layers-2x.png","contexts/flux-layout/node_modules/leaflet/dist/images/layers.png","contexts/flux-layout/node_modules/leaflet/dist/images/marker-icon-2x.png","contexts/flux-layout/node_modules/leaflet/dist/images/marker-icon.png","contexts/flux-layout/node_modules/leaflet/dist/images/marker-shadow.png","contexts/flux-layout/node_modules/leaflet/dist/leaflet-src.esm.js","contexts/flux-layout/node_modules/leaflet/dist/leaflet-src.esm.js.map","contexts/flux-layout/node_modules/leaflet/dist/leaflet-src.js","contexts/flux-layout/node_modules/leaflet/dist/leaflet-src.js.map","contexts/flux-layout/node_modules/leaflet/dist/leaflet.css","contexts/flux-layout/node_modules/leaflet/dist/leaflet.js","contexts/flux-layout/node_modules/leaflet/dist/leaflet.js.map","contexts/flux-layout/node_modules/leaflet/package.json","contexts/flux-layout/node_modules/leaflet/src/Leaflet.js","contexts/flux-layout/node_modules/leaflet/src/control/Control.Attribution.js","contexts/flux-layout/node_modules/leaflet/src/control/Control.Layers.js","contexts/flux-layout/node_modules/leaflet/src/control/Control.Scale.js","contexts/flux-layout/node_modules/leaflet/src/control/Control.Zoom.js","contexts/flux-layout/node_modules/leaflet/src/control/Control.js","contexts/flux-layout/node_modules/leaflet/src/control/index.js","contexts/flux-layout/node_modules/leaflet/src/core/Browser.js","contexts/flux-layout/node_modules/leaflet/src/core/Class.js","contexts/flux-layout/node_modules/leaflet/src/core/Class.leafdoc","contexts/flux-layout/node_modules/leaflet/src/core/Events.js","contexts/flux-layout/node_modules/leaflet/src/core/Events.leafdoc","contexts/flux-layout/node_modules/leaflet/src/core/Handler.js","contexts/flux-layout/node_modules/leaflet/src/core/Util.js","contexts/flux-layout/node_modules/leaflet/src/core/index.js","contexts/flux-layout/node_modules/leaflet/src/dom/DomEvent.DoubleTap.js","contexts/flux-layout/node_modules/leaflet/src/dom/DomEvent.Pointer.js","contexts/flux-layout/node_modules/leaflet/src/dom/DomEvent.js","contexts/flux-layout/node_modules/leaflet/src/dom/DomUtil.js","contexts/flux-layout/node_modules/leaflet/src/dom/Draggable.js","contexts/flux-layout/node_modules/leaflet/src/dom/PosAnimation.js","contexts/flux-layout/node_modules/leaflet/src/dom/index.js","contexts/flux-layout/node_modules/leaflet/src/geo/LatLng.js","contexts/flux-layout/node_modules/leaflet/src/geo/LatLngBounds.js","contexts/flux-layout/node_modules/leaflet/src/geo/crs/CRS.EPSG3395.js","contexts/flux-layout/node_modules/leaflet/src/geo/crs/CRS.EPSG3857.js","contexts/flux-layout/node_modules/leaflet/src/geo/crs/CRS.EPSG4326.js","contexts/flux-layout/node_modules/leaflet/src/geo/crs/CRS.Earth.js","contexts/flux-layout/node_modules/leaflet/src/geo/crs/CRS.Simple.js","contexts/flux-layout/node_modules/leaflet/src/geo/crs/CRS.js","contexts/flux-layout/node_modules/leaflet/src/geo/crs/index.js","contexts/flux-layout/node_modules/leaflet/src/geo/index.js","contexts/flux-layout/node_modules/leaflet/src/geo/projection/Projection.LonLat.js","contexts/flux-layout/node_modules/leaflet/src/geo/projection/Projection.Mercator.js","contexts/flux-layout/node_modules/leaflet/src/geo/projection/Projection.SphericalMercator.js","contexts/flux-layout/node_modules/leaflet/src/geo/projection/index.js","contexts/flux-layout/node_modules/leaflet/src/geometry/Bounds.js","contexts/flux-layout/node_modules/leaflet/src/geometry/LineUtil.js","contexts/flux-layout/node_modules/leaflet/src/geometry/Point.js","contexts/flux-layout/node_modules/leaflet/src/geometry/PolyUtil.js","contexts/flux-layout/node_modules/leaflet/src/geometry/Transformation.js","contexts/flux-layout/node_modules/leaflet/src/geometry/index.js","contexts/flux-layout/node_modules/leaflet/src/images/layers.svg","contexts/flux-layout/node_modules/leaflet/src/images/logo.svg","contexts/flux-layout/node_modules/leaflet/src/images/marker.svg","contexts/flux-layout/node_modules/leaflet/src/layer/DivOverlay.js","contexts/flux-layout/node_modules/leaflet/src/layer/FeatureGroup.js","contexts/flux-layout/node_modules/leaflet/src/layer/GeoJSON.js","contexts/flux-layout/node_modules/leaflet/src/layer/ImageOverlay.js","contexts/flux-layout/node_modules/leaflet/src/layer/Layer.Interactive.leafdoc","contexts/flux-layout/node_modules/leaflet/src/layer/Layer.js","contexts/flux-layout/node_modules/leaflet/src/layer/LayerGroup.js","contexts/flux-layout/node_modules/leaflet/src/layer/Popup.js","contexts/flux-layout/node_modules/leaflet/src/layer/SVGOverlay.js","contexts/flux-layout/node_modules/leaflet/src/layer/Tooltip.js","contexts/flux-layout/node_modules/leaflet/src/layer/VideoOverlay.js","contexts/flux-layout/node_modules/leaflet/src/layer/index.js","contexts/flux-layout/node_modules/leaflet/src/layer/marker/DivIcon.js","contexts/flux-layout/node_modules/leaflet/src/layer/marker/Icon.Default.js","contexts/flux-layout/node_modules/leaflet/src/layer/marker/Icon.js","contexts/flux-layout/node_modules/leaflet/src/layer/marker/Marker.Drag.js","contexts/flux-layout/node_modules/leaflet/src/layer/marker/Marker.js","contexts/flux-layout/node_modules/leaflet/src/layer/marker/index.js","contexts/flux-layout/node_modules/leaflet/src/layer/tile/GridLayer.js","contexts/flux-layout/node_modules/leaflet/src/layer/tile/TileLayer.WMS.js","contexts/flux-layout/node_modules/leaflet/src/layer/tile/TileLayer.js","contexts/flux-layout/node_modules/leaflet/src/layer/tile/index.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/Canvas.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/Circle.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/CircleMarker.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/Path.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/Polygon.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/Polyline.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/Rectangle.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/Renderer.getRenderer.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/Renderer.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/SVG.Util.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/SVG.VML.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/SVG.js","contexts/flux-layout/node_modules/leaflet/src/layer/vector/index.js","contexts/flux-layout/node_modules/leaflet/src/map/Map.js","contexts/flux-layout/node_modules/leaflet/src/map/Map.methodOptions.leafdoc","contexts/flux-layout/node_modules/leaflet/src/map/handler/Map.BoxZoom.js","contexts/flux-layout/node_modules/leaflet/src/map/handler/Map.DoubleClickZoom.js","contexts/flux-layout/node_modules/leaflet/src/map/handler/Map.Drag.js","contexts/flux-layout/node_modules/leaflet/src/map/handler/Map.Keyboard.js","contexts/flux-layout/node_modules/leaflet/src/map/handler/Map.ScrollWheelZoom.js","contexts/flux-layout/node_modules/leaflet/src/map/handler/Map.TapHold.js","contexts/flux-layout/node_modules/leaflet/src/map/handler/Map.TouchZoom.js","contexts/flux-layout/node_modules/leaflet/src/map/index.js","contexts/flux-layout/package-lock.json","contexts/flux-layout/package.json","contexts/flux-layout/src/Adapters/Api/FluxLayoutComponentApi.mjs","contexts/flux-layout/src/Adapters/Definitions/Definitions.mjs","contexts/flux-layout/src/Adapters/MessageStream/MessageStream.mjs","contexts/flux-layout/src/Core/Actor.mjs","contexts/flux-layout/src/Core/Behaviors.mjs","contexts/flux-message-stream/src/Adapters/Api/FluxMessageStreamApi.mjs","contexts/flux-repository/definitions/api/api.json","contexts/flux-repository/src/Adapters/Api/FluxRepositoryApi.mjs","contexts/flux-repository/src/Adapters/Definitions/Definitions.mjs","contexts/flux-repository/src/Adapters/EventStream/MessageStream.mjs","contexts/flux-repository/src/Adapters/Storage/OfflineFirstStorage.mjs","contexts/flux-repository/src/Core/Actor.mjs","contexts/flux-repository/src/Core/Behaviors.mjs","definitions/api/api.json","index.html","serviceworker-template.mjs","serviceworker.mjs"]};

const APPLICATION_CACHE_PREFIX = "learnplaces-application-";

const APPLICATION_CACHE_NAME = `${APPLICATION_CACHE_PREFIX}${APPLICATION_CACHE_VERSION}`;

/**
 * @returns {Promise<Cache>}
 */
async function getApplicationCache() {
    return caches.open(APPLICATION_CACHE_NAME);
}

/**
 * @returns {Promise<void>}
 */
async function cacheApplicationFiles() {
    (await getApplicationCache()).addAll(APPLICATION_CACHE_FILES.map(request => `/Customizing/global/plugins/Services/Repository/RepositoryObject/Learnplaces/pwa/${request}`));
}

/**
 * @param {Request} request
 * @param {Response} response
 * @returns {Promise<void>}
 */
async function cacheApplicationResponse(request, response) {
    (await getApplicationCache()).put(request, response);
}

/**
 * @param {Request} request
 * @returns {Promise<Response | null>}
 */
async function getApplicationCacheResponse(request) {
    return await (await getApplicationCache()).match(request) ?? null;
}

/**
 * @returns {Promise<void>}
 */
async function deleteOldApplicationCaches() {
    await Promise.all((await caches.keys()).filter(key => key.startsWith(APPLICATION_CACHE_PREFIX) && key !== APPLICATION_CACHE_NAME).map(async key => caches.delete(key)));
}

/**
 * @returns {Promise<void>}
 */
async function installEvent() {
    await cacheApplicationFiles();
}

/**
 * @param {Request} request
 * @returns {Promise<Response>}
 */
async function fetchEvent(request) {
    if (!request.url.includes("/Customizing/global/plugins/Services/Repository/RepositoryObject/Learnplaces/pwa/") || request.url.includes(".php")) {
        return fetch(request);
    }

    const cache_response = await getApplicationCacheResponse(
        request
    );
    if (cache_response !== null) {
        return cache_response;
    }

    const response = await fetch(request);

    if (response.ok) {
        cacheApplicationResponse(
            request,
            response.clone()
        );
    }

    return response;
}

/**
 * @returns {Promise<void>}
 */
async function activateEvent() {
    await clients.claim();

    await deleteOldApplicationCaches();
}

addEventListener("install", e => {
    e.waitUntil(installEvent());
});

addEventListener("fetch", e => {
    e.respondWith(fetchEvent(
        e.request
    ));
});

addEventListener("activate", e => {
    e.waitUntil(activateEvent());
});
