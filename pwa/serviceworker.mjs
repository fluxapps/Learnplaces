const { APPLICATION_CACHE_FILES, APPLICATION_CACHE_VERSION } = {"APPLICATION_CACHE_VERSION":"6dd9a71b-62b3-4fc5-b25d-8e7da86bd85c","APPLICATION_CACHE_FILES":["","app.mjs","appmanifest.webmanifest","assets/illustration-04.svg","assets/pegasus.webp","contexts/gateway/.git/HEAD","contexts/gateway/.git/config","contexts/gateway/.git/description","contexts/gateway/.git/hooks/applypatch-msg.sample","contexts/gateway/.git/hooks/commit-msg.sample","contexts/gateway/.git/hooks/fsmonitor-watchman.sample","contexts/gateway/.git/hooks/post-update.sample","contexts/gateway/.git/hooks/pre-applypatch.sample","contexts/gateway/.git/hooks/pre-commit.sample","contexts/gateway/.git/hooks/pre-merge-commit.sample","contexts/gateway/.git/hooks/pre-push.sample","contexts/gateway/.git/hooks/pre-rebase.sample","contexts/gateway/.git/hooks/pre-receive.sample","contexts/gateway/.git/hooks/prepare-commit-msg.sample","contexts/gateway/.git/hooks/push-to-checkout.sample","contexts/gateway/.git/hooks/update.sample","contexts/gateway/.git/info/exclude","contexts/gateway/definitions/api/api.json","contexts/gateway/examples/ping-pong/definitions/api/api.json","contexts/gateway/examples/ping-pong/index.html","contexts/gateway/examples/ping-pong/main.mjs","contexts/gateway/src/Adapters/Api/Config.mjs","contexts/gateway/src/Adapters/Api/FluxGatewayApi.mjs","contexts/gateway/src/Adapters/Definitions/Definitions.mjs","contexts/gateway/src/Adapters/MessageStream/MessageStream.mjs","contexts/gateway/src/Core/Actor.mjs","contexts/gateway/src/Core/Behaviors.mjs","contexts/layout/.git/HEAD","contexts/layout/.git/config","contexts/layout/.git/description","contexts/layout/.git/hooks/applypatch-msg.sample","contexts/layout/.git/hooks/commit-msg.sample","contexts/layout/.git/hooks/fsmonitor-watchman.sample","contexts/layout/.git/hooks/post-update.sample","contexts/layout/.git/hooks/pre-applypatch.sample","contexts/layout/.git/hooks/pre-commit.sample","contexts/layout/.git/hooks/pre-merge-commit.sample","contexts/layout/.git/hooks/pre-push.sample","contexts/layout/.git/hooks/pre-rebase.sample","contexts/layout/.git/hooks/pre-receive.sample","contexts/layout/.git/hooks/prepare-commit-msg.sample","contexts/layout/.git/hooks/push-to-checkout.sample","contexts/layout/.git/hooks/update.sample","contexts/layout/.git/info/exclude","contexts/layout/.gitignore","contexts/layout/definitions/api/api.json","contexts/layout/definitions/css/stylesheet.css","contexts/layout/definitions/templates/content-container.mjs","contexts/layout/definitions/templates/header.mjs","contexts/layout/definitions/templates/map-location.mjs","contexts/layout/definitions/templates/map-marker.mjs","contexts/layout/definitions/templates/map.mjs","contexts/layout/definitions/templates/menu-item.mjs","contexts/layout/definitions/templates/menu.mjs","contexts/layout/definitions/templates/string.mjs","contexts/layout/docs/api.png","contexts/layout/examples/header-and-content/index.html","contexts/layout/examples/header-and-content/main.mjs","contexts/layout/libs/leaflet/CHANGELOG.md","contexts/layout/libs/leaflet/LICENSE","contexts/layout/libs/leaflet/README.md","contexts/layout/libs/leaflet/dist/images/layers-2x.png","contexts/layout/libs/leaflet/dist/images/layers.png","contexts/layout/libs/leaflet/dist/images/marker-icon-2x.png","contexts/layout/libs/leaflet/dist/images/marker-icon.png","contexts/layout/libs/leaflet/dist/images/marker-shadow.png","contexts/layout/libs/leaflet/dist/leaflet-src.esm.js","contexts/layout/libs/leaflet/dist/leaflet-src.esm.js.map","contexts/layout/libs/leaflet/dist/leaflet-src.js","contexts/layout/libs/leaflet/dist/leaflet-src.js.map","contexts/layout/libs/leaflet/dist/leaflet.css","contexts/layout/libs/leaflet/dist/leaflet.js","contexts/layout/libs/leaflet/dist/leaflet.js.map","contexts/layout/libs/leaflet/package.json","contexts/layout/libs/leaflet/src/Leaflet.js","contexts/layout/libs/leaflet/src/control/Control.Attribution.js","contexts/layout/libs/leaflet/src/control/Control.Layers.js","contexts/layout/libs/leaflet/src/control/Control.Scale.js","contexts/layout/libs/leaflet/src/control/Control.Zoom.js","contexts/layout/libs/leaflet/src/control/Control.js","contexts/layout/libs/leaflet/src/control/index.js","contexts/layout/libs/leaflet/src/core/Browser.js","contexts/layout/libs/leaflet/src/core/Class.js","contexts/layout/libs/leaflet/src/core/Class.leafdoc","contexts/layout/libs/leaflet/src/core/Events.js","contexts/layout/libs/leaflet/src/core/Events.leafdoc","contexts/layout/libs/leaflet/src/core/Handler.js","contexts/layout/libs/leaflet/src/core/Util.js","contexts/layout/libs/leaflet/src/core/index.js","contexts/layout/libs/leaflet/src/dom/DomEvent.DoubleTap.js","contexts/layout/libs/leaflet/src/dom/DomEvent.Pointer.js","contexts/layout/libs/leaflet/src/dom/DomEvent.js","contexts/layout/libs/leaflet/src/dom/DomUtil.js","contexts/layout/libs/leaflet/src/dom/Draggable.js","contexts/layout/libs/leaflet/src/dom/PosAnimation.js","contexts/layout/libs/leaflet/src/dom/index.js","contexts/layout/libs/leaflet/src/geo/LatLng.js","contexts/layout/libs/leaflet/src/geo/LatLngBounds.js","contexts/layout/libs/leaflet/src/geo/crs/CRS.EPSG3395.js","contexts/layout/libs/leaflet/src/geo/crs/CRS.EPSG3857.js","contexts/layout/libs/leaflet/src/geo/crs/CRS.EPSG4326.js","contexts/layout/libs/leaflet/src/geo/crs/CRS.Earth.js","contexts/layout/libs/leaflet/src/geo/crs/CRS.Simple.js","contexts/layout/libs/leaflet/src/geo/crs/CRS.js","contexts/layout/libs/leaflet/src/geo/crs/index.js","contexts/layout/libs/leaflet/src/geo/index.js","contexts/layout/libs/leaflet/src/geo/projection/Projection.LonLat.js","contexts/layout/libs/leaflet/src/geo/projection/Projection.Mercator.js","contexts/layout/libs/leaflet/src/geo/projection/Projection.SphericalMercator.js","contexts/layout/libs/leaflet/src/geo/projection/index.js","contexts/layout/libs/leaflet/src/geometry/Bounds.js","contexts/layout/libs/leaflet/src/geometry/LineUtil.js","contexts/layout/libs/leaflet/src/geometry/Point.js","contexts/layout/libs/leaflet/src/geometry/PolyUtil.js","contexts/layout/libs/leaflet/src/geometry/Transformation.js","contexts/layout/libs/leaflet/src/geometry/index.js","contexts/layout/libs/leaflet/src/images/layers.svg","contexts/layout/libs/leaflet/src/images/logo.svg","contexts/layout/libs/leaflet/src/images/marker.svg","contexts/layout/libs/leaflet/src/layer/DivOverlay.js","contexts/layout/libs/leaflet/src/layer/FeatureGroup.js","contexts/layout/libs/leaflet/src/layer/GeoJSON.js","contexts/layout/libs/leaflet/src/layer/ImageOverlay.js","contexts/layout/libs/leaflet/src/layer/Layer.Interactive.leafdoc","contexts/layout/libs/leaflet/src/layer/Layer.js","contexts/layout/libs/leaflet/src/layer/LayerGroup.js","contexts/layout/libs/leaflet/src/layer/Popup.js","contexts/layout/libs/leaflet/src/layer/SVGOverlay.js","contexts/layout/libs/leaflet/src/layer/Tooltip.js","contexts/layout/libs/leaflet/src/layer/VideoOverlay.js","contexts/layout/libs/leaflet/src/layer/index.js","contexts/layout/libs/leaflet/src/layer/marker/DivIcon.js","contexts/layout/libs/leaflet/src/layer/marker/Icon.Default.js","contexts/layout/libs/leaflet/src/layer/marker/Icon.js","contexts/layout/libs/leaflet/src/layer/marker/Marker.Drag.js","contexts/layout/libs/leaflet/src/layer/marker/Marker.js","contexts/layout/libs/leaflet/src/layer/marker/index.js","contexts/layout/libs/leaflet/src/layer/tile/GridLayer.js","contexts/layout/libs/leaflet/src/layer/tile/TileLayer.WMS.js","contexts/layout/libs/leaflet/src/layer/tile/TileLayer.js","contexts/layout/libs/leaflet/src/layer/tile/index.js","contexts/layout/libs/leaflet/src/layer/vector/Canvas.js","contexts/layout/libs/leaflet/src/layer/vector/Circle.js","contexts/layout/libs/leaflet/src/layer/vector/CircleMarker.js","contexts/layout/libs/leaflet/src/layer/vector/Path.js","contexts/layout/libs/leaflet/src/layer/vector/Polygon.js","contexts/layout/libs/leaflet/src/layer/vector/Polyline.js","contexts/layout/libs/leaflet/src/layer/vector/Rectangle.js","contexts/layout/libs/leaflet/src/layer/vector/Renderer.getRenderer.js","contexts/layout/libs/leaflet/src/layer/vector/Renderer.js","contexts/layout/libs/leaflet/src/layer/vector/SVG.Util.js","contexts/layout/libs/leaflet/src/layer/vector/SVG.VML.js","contexts/layout/libs/leaflet/src/layer/vector/SVG.js","contexts/layout/libs/leaflet/src/layer/vector/index.js","contexts/layout/libs/leaflet/src/map/Map.js","contexts/layout/libs/leaflet/src/map/Map.methodOptions.leafdoc","contexts/layout/libs/leaflet/src/map/handler/Map.BoxZoom.js","contexts/layout/libs/leaflet/src/map/handler/Map.DoubleClickZoom.js","contexts/layout/libs/leaflet/src/map/handler/Map.Drag.js","contexts/layout/libs/leaflet/src/map/handler/Map.Keyboard.js","contexts/layout/libs/leaflet/src/map/handler/Map.ScrollWheelZoom.js","contexts/layout/libs/leaflet/src/map/handler/Map.TapHold.js","contexts/layout/libs/leaflet/src/map/handler/Map.TouchZoom.js","contexts/layout/libs/leaflet/src/map/index.js","contexts/layout/src/Adapters/Api/Config.mjs","contexts/layout/src/Adapters/Api/FluxLayoutApi.mjs","contexts/layout/src/Adapters/Definitions/Definitions.mjs","contexts/layout/src/Adapters/MessageStream/MessageStream.mjs","contexts/layout/src/Core/Actor.mjs","contexts/layout/src/Core/Behaviors.mjs","contexts/layout/src/Core/Elements/AppElement.mjs","contexts/layout/src/Core/Elements/MapElement.mjs","contexts/repository/.git/COMMIT_EDITMSG","contexts/repository/.git/FETCH_HEAD","contexts/repository/.git/HEAD","contexts/repository/.git/ORIG_HEAD","contexts/repository/.git/config","contexts/repository/.git/description","contexts/repository/.git/hooks/applypatch-msg.sample","contexts/repository/.git/hooks/commit-msg.sample","contexts/repository/.git/hooks/fsmonitor-watchman.sample","contexts/repository/.git/hooks/post-update.sample","contexts/repository/.git/hooks/pre-applypatch.sample","contexts/repository/.git/hooks/pre-commit.sample","contexts/repository/.git/hooks/pre-merge-commit.sample","contexts/repository/.git/hooks/pre-push.sample","contexts/repository/.git/hooks/pre-rebase.sample","contexts/repository/.git/hooks/pre-receive.sample","contexts/repository/.git/hooks/prepare-commit-msg.sample","contexts/repository/.git/hooks/push-to-checkout.sample","contexts/repository/.git/hooks/update.sample","contexts/repository/.git/index","contexts/repository/.git/info/exclude","contexts/repository/.git/logs/HEAD","contexts/repository/.git/logs/refs/heads/main","contexts/repository/.git/logs/refs/remotes/origin/HEAD","contexts/repository/.git/logs/refs/remotes/origin/main","contexts/repository/.git/objects/0f/7d73f11ae9a311a7389ea4f2671446a24b0ce5","contexts/repository/.git/objects/1a/56dfe4a265dcf7c0dafac1144d2190046e5e29","contexts/repository/.git/objects/2f/e922f175fcfad3c9b79cba994d99f560701fa7","contexts/repository/.git/objects/3d/99756787a9e953bfe3922c614f038c98d67d69","contexts/repository/.git/objects/3f/663e18e251cbfc3da19368e45a2492d7c88aa1","contexts/repository/.git/objects/43/b206e18b253edb3fc1a56f155523455a5d2495","contexts/repository/.git/objects/4b/9f967aea15a36fe726320c49d8af267164770f","contexts/repository/.git/objects/5b/34daf0a498879a4c60f43b04aadea0be624b9c","contexts/repository/.git/objects/61/7caccb0f8d56b0588d1481b4e15f8eeacbb12d","contexts/repository/.git/objects/63/0d941645898785013f3dfd2500f234f41d23de","contexts/repository/.git/objects/67/fc990219ad97d53288c3b3944c3e96bde822d6","contexts/repository/.git/objects/68/2120334813189d8c62e56a4a544ecd60dc2210","contexts/repository/.git/objects/73/14a2dc895c5b477576bc2a104771bf68c0be0d","contexts/repository/.git/objects/7f/2b1fe710683fe5683fad91f0ac60c26897ab3e","contexts/repository/.git/objects/98/f08b4ae1a87542a5a5111d76bc756af9d4c53e","contexts/repository/.git/objects/a6/907dfe97852fdb353cb292d453971f76af1b17","contexts/repository/.git/objects/b8/05b4db8d1325ec6a618037b4fdbc0ad7248ee5","contexts/repository/.git/objects/c4/6862e0aedd9f39c97a58fd672d9c5b68c259db","contexts/repository/.git/objects/ca/95d26038f818ef563b2da691d25d15d3fe3dc4","contexts/repository/.git/objects/d3/1a65f24776c45227abb7ac86d5f36541f9107e","contexts/repository/.git/objects/db/a7950439baca2b8ab1d3835ec99d2ea7f27baa","contexts/repository/.git/objects/df/8c0e5f806ce207a3bcaf419a31aa36f818d58f","contexts/repository/.git/objects/e5/9e5bbbee0f24ff551854681f8b88571da6100d","contexts/repository/.git/objects/e9/2992fb1ac0b7875ce5b485b86a6f8b779f6299","contexts/repository/.git/objects/f7/2887b2e218bcd8070389e839dedc7008d03c9b","contexts/repository/.git/objects/f8/bc687ba3b1481b8d73877ffebea1cbd0d78e0f","contexts/repository/.git/objects/pack/pack-56eee21511f9431c8ff9735983d60e1d496aeef3.idx","contexts/repository/.git/objects/pack/pack-56eee21511f9431c8ff9735983d60e1d496aeef3.pack","contexts/repository/.git/packed-refs","contexts/repository/.git/refs/heads/main","contexts/repository/.git/refs/remotes/origin/HEAD","contexts/repository/.git/refs/remotes/origin/main","contexts/repository/.gitignore","contexts/repository/README.md","contexts/repository/definitions/api/api.json","contexts/repository/docs/api.png","contexts/repository/examples/offline-first/any-backend/person.json","contexts/repository/examples/offline-first/index.html","contexts/repository/examples/offline-first/main.mjs","contexts/repository/src/Adapters/Api/Config.mjs","contexts/repository/src/Adapters/Api/FluxRepositoryApi.mjs","contexts/repository/src/Adapters/Definitions/Definitions.mjs","contexts/repository/src/Adapters/EventStream/MessageStream.mjs","contexts/repository/src/Adapters/Storage/OfflineFirstStorage.mjs","contexts/repository/src/Core/Actor.mjs","contexts/repository/src/Core/Behaviors.mjs","definitions/api/api.json","index.html","serviceworker-template.mjs","serviceworker.mjs"]};

const APPLICATION_CACHE_PREFIX = "learnplaces-application-";

const APPLICATION_CACHE_NAME = `${APPLICATION_CACHE_PREFIX}${APPLICATION_CACHE_VERSION}`;

/**
 * @returns {Promise<Cache>}
 */
async function getApplicationCache() {
    return caches.open(APPLICATION_CACHE_NAME);
}

/**
 * @returns {Promise<void>}
 */
async function cacheApplicationFiles() {
    (await getApplicationCache()).addAll(APPLICATION_CACHE_FILES.map(request => `/Customizing/global/plugins/Services/Repository/RepositoryObject/Learnplaces/pwa/${request}`));
}

/**
 * @param {Request} request
 * @param {Response} response
 * @returns {Promise<void>}
 */
async function cacheApplicationResponse(request, response) {
    (await getApplicationCache()).put(request, response);
}

/**
 * @param {Request} request
 * @returns {Promise<Response | null>}
 */
async function getApplicationCacheResponse(request) {
    return await (await getApplicationCache()).match(request) ?? null;
}

/**
 * @returns {Promise<void>}
 */
async function deleteOldApplicationCaches() {
    await Promise.all((await caches.keys()).filter(key => key.startsWith(APPLICATION_CACHE_PREFIX) && key !== APPLICATION_CACHE_NAME).map(async key => caches.delete(key)));
}

/**
 * @returns {Promise<void>}
 */
async function installEvent() {
    await cacheApplicationFiles();
}

/**
 * @param {Request} request
 * @returns {Promise<Response>}
 */
async function fetchEvent(request) {
    if (!request.url.includes("/Customizing/global/plugins/Services/Repository/RepositoryObject/Learnplaces/pwa/") || request.url.includes(".php")) {
        return fetch(request);
    }

    const cache_response = await getApplicationCacheResponse(
        request
    );
    if (cache_response !== null) {
        return cache_response;
    }

    const response = await fetch(request);

    if (response.ok) {
        cacheApplicationResponse(
            request,
            response.clone()
        );
    }

    return response;
}

/**
 * @returns {Promise<void>}
 */
async function activateEvent() {
    await clients.claim();

    await deleteOldApplicationCaches();
}

addEventListener("install", e => {
    e.waitUntil(installEvent());
});

addEventListener("fetch", e => {
    e.respondWith(fetchEvent(
        e.request
    ));
});

addEventListener("activate", e => {
    e.waitUntil(activateEvent());
});
